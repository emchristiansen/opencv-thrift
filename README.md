#OpenCV-Thrift
This is a hand-written wrapper / RPC interface to [OpenCV](https://github.com/Itseez/opencv) using [Apache Thrift](https://github.com/apache/thrift).
It was originally created to provide a Haskell interface, but it should make it easy to call OpenCV from [any one of a number of languages](http://thrift.apache.org/docs/features/), including: C++, C#, Cocoa, D, Delphi, Erlang, Haskell, Java, OCaml, Perl, PHP, Python, Ruby, and Smalltalk.
Like [Protocol Buffers](https://developers.google.com/protocol-buffers/), it allows any wrapped type to be serialized to an efficient format, for say disk storage.
Finally it provides an RPC mechanism for making function calls across network connections.

(Update: This isn't even alpha yet. Check back later.)

[![Build Status](https://travis-ci.org/emchristiansen/opencv-thrift.png)](https://travis-ci.org/emchristiansen/opencv-thrift)

##How this is different from OpenCV's existing FFIs
OpenCV already has foreign function interfaces (FFIs) to a number of languages besides C++, including Python, Java, Matlab.
These interfaces tend to expose pointers to C++ objects, rather than copying and translating those objects into native types of the target language.
This avoids copying-related overhead, but can make using such interfaces difficult from languages which are substantially different from C++ (e.g. Haskell).

A more serious problem with the existing FFIs is that they are automatically generated to mirror the C++ API, and the C++ API poses problems for non-C++-like languages.
In particular, it is not [referentially transparent](http://en.wikipedia.org/wiki/Referential_transparency_\(computer_science\)), making it a pain to expose to Haskell.
So, to support Haskell, we need to write a new interface.
And we might as well write it in Thrift's IDL so we can talk to other languages for free.

##Related works

  * There are a number of Haskell projects which have attempted to wrap OpenCV.
    * The most recent that I know of is [by](https://github.com/arjuncomar/revelation) [Arjun](https://github.com/arjuncomar/opencv-raw) [Comar](https://github.com/arjuncomar/opencv).
This was taking the same tack as the official autogenerated wrappers for the other languages, so it had to work around difficulties with OpenCV's non-referentially-transparent API.
Unfortunately, the project seems dead at this point.
    * [HOpenCV](http://hackage.haskell.org/package/HOpenCV) and [CV](http://hackage.haskell.org/package/CV) both manually wrap a subset of OpenCV 2.x and seem poorly maintained.
  * [Cap'n Proto](http://kentonv.github.io/capnproto/capnp-tool.html), created by an author of Google's Protocol Buffers, seems like it may one day replace Thrift.
I'd like to use it, but I'll wait for it to officially support Haskell.

#Getting started
Apache Thrift requires a project's API be defined in terms of its own [interface definition language](http://thrift.apache.org/docs/idl/) (IDL).
It can then generate language-specific server-side stubs and client interfaces.
Those IDL files are in `interface/`.

The implementation of the interface, written using C++ and OpenCV, is in `implementation/`.
This should be built and installed globally (`sudo make install`).

The client interface for Haskell is in `hs/`.
Apache Thrift doesn't do a great job with Haskell, so the autogenerated interface has been modified a bit.

Currently, Apache Thrift only works via RPC over some kind of network connection.
This isn't fundamental to the protocol, but for now you need to start an OpenCV server on a local port and connect to it with a network client.
`serverLocalhost/` defines an executable OpenCV server; start it before you run your client.
`hsLocalhost/` defines a library for calling to the above server; look at its `bin/` folder for example usage.

#TODO

  * The installed version of the project should probably be renamed to OpenCVThrift to avoid naming conflicts with OpenCV itself.
  * Fix Thrift's Haskell generator so it generates more idiomatic code.
  * Enhance Thrift so it doesn't require RPC.
